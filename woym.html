<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
  <meta charset="utf-8">
  <title>(˵ ͡° ͜ʖ ͡°˵)</title>
  <link rel="icon" href="assets/favicon.ico">
  <link rel="stylesheet" type="text/css" href="style.css">
  <style>
    #canvasContainer { margin-top: 1rem; }
    canvas { border: 1px solid #000; background: #fff; display: block; }
    #downloadBtn {
  font-family: "Times New Roman", Times, serif;
  font-size: 11pt;
  letter-spacing: -0.3px;
  background: none;
  border: none;
  color: black;
  text-decoration: underline;
  cursor: pointer;
  padding: 0;
}
    #gallery { margin-top:1rem; display:grid; grid-template-columns:repeat(auto-fill,150px); gap:10px; }
    #gallery img { max-width:150px; border:1px solid #ccc; }
    .text { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div id="content">
    <div class="container">
      <div class="text">
        <a href='index' id="home-link">*</a><br>
       ✎ what's on your mind? ( double click to start again )
      </div>
    </div>
  </div>

  <div id="canvasContainer">
    <canvas id="drawCanvas" width="500" height="500"></canvas>
    <button id="downloadBtn">send! (I want to be a proud collector)</button>

    <div style="margin-top:10px;">
  <button id="eraserBtn">Eraser</button>
  <select id="colorPicker">
    <option value="#000000">Black</option>
    <option value="#ff0000">Red</option>
    <option value="#0000ff">Blue</option>
    <option value="#00ff00">Green</option>
    <option value="#ffff00">Yellow</option>
  </select>
</div>

    <div id="gallery"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    emailjs.init({ publicKey: "l06doB2wxnGk4vSmz" });

    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    const btn = document.getElementById('downloadBtn');
    let drawing = false;

    // Dibujo
    canvas.addEventListener('mousedown', () => drawing = true);
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);
    canvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      ctx.beginPath();
      ctx.arc(e.clientX - rect.left, e.clientY - rect.top, 2, 0, Math.PI * 2);
      ctx.fillStyle = "#000";
      ctx.fill();
    });
    canvas.addEventListener('dblclick', () => ctx.clearRect(0, 0, canvas.width, canvas.height));

    // Galería y localStorage
    const gallery = document.getElementById("gallery");
    const savedImages = JSON.parse(localStorage.getItem("galleryImages") || "[]");

    savedImages.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      gallery.appendChild(img);
    });

    // Enviar dibujo por EmailJS y guardar en galería
    btn.addEventListener('click', async () => {
      const dataURL = canvas.toDataURL("image/png");

      // Guardar en galería
      const img = document.createElement("img");
      img.src = dataURL;
      gallery.appendChild(img);
      savedImages.push(dataURL);
      localStorage.setItem("galleryImages", JSON.stringify(savedImages));

      // Enviar EmailJS
      const params = {
        to_email: "casfemarta@gmail.com",
        message: "para descargar en .png primero guardar en Google Fotos y de ahí descargar",
        attachment: dataURL
      };

      btn.disabled = true;
      btn.textContent = "sending...";

      try {
        await emailjs.send("service_o3jmvle", "template_r72a0hl", params);
        alert("éxito rotundo");
      } catch (err) {
        console.error("Error detallado:", err);
        alert(" E R R O R ");
      } finally {
        btn.disabled = false;
        btn.textContent = "send another!";
      }
    });

    // Herramientas: borrador y colores
let currentColor = "#000";
let erasing = false;

document.getElementById('colorPicker').addEventListener('change', e => {
  currentColor = e.target.value;
  erasing = false;
});

document.getElementById('eraserBtn').addEventListener('click', () => {
  erasing = !erasing;
});

canvas.addEventListener('mousemove', e => {
  if (!drawing) return;
  const rect = canvas.getBoundingClientRect();
  ctx.beginPath();
  ctx.arc(e.clientX - rect.left, e.clientY - rect.top, 2, 0, Math.PI * 2);
  ctx.fillStyle = erasing ? "#fff" : currentColor;
  ctx.fill();
});

  </script>
</body>
</html>
