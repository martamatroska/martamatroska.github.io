<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JTH + Are.na Fullwidth</title>
    
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.12/jquery.transit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            font-family: "Times New Roman", Times, serif;
        }

        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            font-size: 24pt;
            font-weight: 700;
            pointer-events: none;
            color: #1a1a1a;
            text-transform: lowercase;
        }

        header {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 9999;
            
        }

        nav li { list-style: none; margin: 0; padding: 0; }
        
         a {
            text-decoration: none; 
            color: blue;   
            white-space: nowrap;
               
        }

        a:hover {
            color: #ffffff; 
            background-color: rgb(0, 0, 0);
        }

        .container-chaos {
            list-style: none;
            margin: 0;
            padding: 0;
            position: relative;
            width: 100%;
            min-height: 100vh;
        }

        .work-item {
            position: absolute;
            width: 320px;
            display: block; 
            z-index: 10;
            cursor: grab;
            opacity: 0;
            /* Eliminamos transiciones para que el cambio sea instantáneo */
            transition: none !important;
        }

        /* Clase para el modo pantalla completa ajustado al ANCHO */
        .work-item.is-fullscreen {
            position: absolute !important; /* Absolute para permitir scroll de la imagen larga */
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: auto !important;
            z-index: 10000 !important;
            cursor: zoom-out;
            rotate: 0deg !important; 
            transform: none !important;
        }

        .work-item.is-fullscreen img {
            width: 100%;
            height: auto; /* Ajuste al ancho, altura proporcional */
            display: block;
        }

        .thumb {
            width: 100%;
            height: auto;
            display: block;
            pointer-events: none; 
            -webkit-user-drag: none;
        }

        .ui-draggable-dragging {
            cursor: grabbing !important;
            z-index: 9998 !important;
        }
    </style>
</head>
<body>

    <div id="info"></div>

    <header>
         <nav>
            <li><a href="indexjt.html" style="color: inherit;">Juan Tribaldos</a></li>
            <li><a href="worksjt.html">works</a></li>
            <li><a href="aboutjt.html">about</a></li>
            <li><a href="mailto:juantribaldos@gmail.com">juantribaldos (at) gmail (dot) com</a></li>
        </nav>
    </header>

    <main>
        <ul class="container-chaos" id="arena-container"></ul>
    </main>

    <script>
    $(function() {
        const CHANNEL_SLUG = 'angela-test'; 
        const API_BASE = 'https://api.are.na/v2';

        async function fetchArenaBlocks() {
            try {
                const response = await fetch(`${API_BASE}/channels/${CHANNEL_SLUG}/contents?per=50&direction=desc`, {
                    headers: { 'Cache-Control': 'no-cache' }
                });
                const data = await response.json();
                return data.contents.filter(block => block.class === 'Image');
            } catch (error) {
                console.error('Error fetching Arena:', error);
                return [];
            }
        }

        function applyChaosLogic(element) {
            const $el = $(element);
            const sign = Math.random() < 0.5 ? '-' : '+';
            const posx = Math.random() * ($(window).width() - 350);
            const posy = Math.random() * ($(window).height() + 500);
            const rota = (Math.random() * 20).toFixed(2);
            const rotationString = sign + rota + 'deg';

            $el.css({
                'left': posx + 'px',
                'top': posy + 'px',
                'rotate': rotationString,
                'opacity': 1
            });

            $el.draggable({
                stack: ".work-item",
                start: function() {
                    if ($(this).hasClass('is-fullscreen')) return false;
                }
            });

            $el.hover(
                function() { 
                    if (!$(this).hasClass('is-fullscreen')) {
                        $('#info').text($(this).attr('data-hover'));
                        $(this).css('z-index', '9000');
                    }
                }, 
                function() { 
                    $('#info').text('');
                    if (!$(this).hasClass('is-fullscreen')) $(this).css('z-index', '10');
                }
            );

            $el.on('click', function(e) {
                e.preventDefault();
                if ($(this).hasClass('ui-draggable-dragging')) return;

                const $this = $(this);

                if (!$this.hasClass('is-fullscreen')) {
                    // Guardamos la posición del scroll actual para volver a ella si fuera necesario
                    $this.data('scroll-pos', $(window).scrollTop());
                    
                    $this.data('current-left', $this.css('left'));
                    $this.data('current-top', $this.css('top'));
                    $this.data('current-rotate', $this.css('rotate'));

                    $this.addClass('is-fullscreen');
                    // Al abrir, hacemos scroll al principio de la imagen
                    $(window).scrollTop(0);
                    $('#info').hide();
                } else {
                    $this.removeClass('is-fullscreen');
                    
                    $this.css({
                        'left': $this.data('current-left'),
                        'top': $this.data('current-top'),
                        'rotate': $this.data('current-rotate')
                    });
                    
                    // Al cerrar, devolvemos el scroll a donde estaba antes de ampliar
                    $(window).scrollTop($this.data('scroll-pos'));
                    $('#info').show();
                }
            });
        }

        async function init() {
            const blocks = await fetchArenaBlocks();
            const $container = $('#arena-container');

            blocks.forEach(block => {
                const imageUrl = block.image.display.url;
                const title = block.title || "untitled";
                
                const html = `
                    <li class="work-item" data-hover="${title}">
                        <a href="#">
                            <img class="thumb" src="${imageUrl}" />
                        </a>
                    </li>
                `;
                
                const $newItem = $(html);
                $container.append($newItem);
                applyChaosLogic($newItem);
            });
        }

        init();
    });
    </script>

</body>
</html>