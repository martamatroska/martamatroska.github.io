<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JTH</title>
    
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.12/jquery.transit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            font-family: "Times New Roman", Times, serif;
            overflow-x: hidden;
        }

        /* Clase para evitar el doble scroll al ampliar */
        body.lock-scroll {
            overflow: hidden;
        }

        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            font-size: 24pt;
            font-weight: 700;
            pointer-events: none;
            color: #1a1a1a;
            text-transform: lowercase;
            max-width: 500px;
            line-height: 1.1;
        }

        .info-desc {
            font-size: 14pt;
            font-weight: 400;
            margin-top: 8px;
            color: #444;
        }

        header {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 9999;
        }

        nav li { 
            list-style: none; 
            margin: 0; 
            padding: 0; 
            font-weight: normal; /* Asegura que no haya negritas por defecto */
        }
        
        a { text-decoration: none; color: blue; }

        .container-chaos {
            list-style: none;
            margin: 0;
            padding: 0;
            position: relative;
            width: 100%;
            min-height: 150vh; 
        }

        .work-item {
            position: absolute;
            width: 320px;
            display: block; 
            z-index: 10;
            cursor: grab;
            opacity: 0;
            transition: none !important;
        }

        /* Modo pantalla completa ajustable al ancho */
        .work-item.is-fullscreen {
            position: fixed !important; /* Cambiado a fixed para controlar mejor el scroll Ãºnico */
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 10000 !important;
            cursor: zoom-out;
            rotate: 0deg !important; 
            transform: none !important;
            overflow-y: auto; /* Permite scroll interno si la imagen es larga */
            background: white; /* Evita ver el caos debajo si hay transparencias */
        }

        .work-item.is-fullscreen img {
            width: 100%;
            height: auto;
            display: block;
        }

        .thumb {
            width: 100%;
            height: auto;
            display: block;
            pointer-events: none; 
            -webkit-user-drag: none;
            box-shadow: none !important;
        }

        .ui-draggable-dragging {
            cursor: grabbing !important;
            z-index: 9998 !important;
        }
    </style>
</head>
<body>

    <div id="info"></div>

    <header>
        <nav>
            <li style="color: black;">Juan Tribaldos</li>
            <li><a href="worksjt.html">works</a></li>
            <li><a href="aboutjt.html">about</a></li>
            <li><a href="mailto:juantribaldos@gmail.com">juantribaldos (at) gmail (dot) com</a></li>
        </nav>
    </header>

    <main>
        <ul class="container-chaos" id="arena-container"></ul>
    </main>

    <script>
    $(function() {
        const CHANNEL_SLUG = 'angela-test'; 
        const API_BASE = 'https://api.are.na/v2';

        async function fetchArenaBlocks() {
            try {
                const response = await fetch(`${API_BASE}/channels/${CHANNEL_SLUG}/contents?per=50&direction=desc`, {
                    headers: { 'Cache-Control': 'no-cache' }
                });
                const data = await response.json();
                return data.contents.filter(block => block.class === 'Image');
            } catch (error) {
                console.error('Error fetching Arena:', error);
                return [];
            }
        }

        function applyChaosLogic(element) {
            const $el = $(element);
            const sign = Math.random() < 0.5 ? '-' : '+';
            const posx = Math.random() * ($(window).width() - 350);
            const posy = Math.random() * ($(window).height() + 500);
            const rota = (Math.random() * 20).toFixed(2);
            const rotationString = sign + rota + 'deg';

            $el.css({
                'left': posx + 'px',
                'top': posy + 'px',
                'rotate': rotationString,
                'opacity': 1
            });

            $el.draggable({
                stack: ".work-item",
                start: function() {
                    if ($(this).hasClass('is-fullscreen')) return false;
                }
            });

            $el.hover(
                function() { 
                    if (!$(this).hasClass('is-fullscreen')) {
                        const title = $(this).attr('data-title');
                        const date = $(this).attr('data-date');
                        const desc = $(this).attr('data-description');
                        
                        let infoHtml = `<div>${title} <span style="font-weight:400; font-size:18pt;">(${date})</span></div>`;
                        if (desc && desc !== "null" && desc !== "") {
                            infoHtml += `<div class="info-desc">${desc}</div>`;
                        }

                        $('#info').html(infoHtml);
                        $(this).css('z-index', '9000');
                    }
                }, 
                function() { 
                    $('#info').html('');
                    if (!$(this).hasClass('is-fullscreen')) $(this).css('z-index', '10');
                }
            );

            $el.on('click', function(e) {
                e.preventDefault();
                if ($(this).hasClass('ui-draggable-dragging')) return;

                const $this = $(this);

                if (!$this.hasClass('is-fullscreen')) {
                    $this.data('scroll-pos', $(window).scrollTop());
                    $this.data('current-left', $this.css('left'));
                    $this.data('current-top', $this.css('top'));
                    $this.data('current-rotate', $this.css('rotate'));

                    $this.addClass('is-fullscreen');
                    $('body').addClass('lock-scroll'); // Bloqueamos el scroll del fondo
                    $this.scrollTop(0); // Scroll al inicio de la imagen
                    $('#info').hide();
                } else {
                    $this.removeClass('is-fullscreen');
                    $('body').removeClass('lock-scroll'); // Liberamos el scroll
                    
                    $this.css({
                        'left': $this.data('current-left'),
                        'top': $this.data('current-top'),
                        'rotate': $this.data('current-rotate')
                    });
                    
                    $(window).scrollTop($this.data('scroll-pos'));
                    $('#info').show();
                }
            });
        }

        async function init() {
            const blocks = await fetchArenaBlocks();
            const $container = $('#arena-container');

            blocks.forEach(block => {
                const imageUrl = block.image.display.url;
                const title = block.title || "untitled";
                const date = new Date(block.created_at).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'short'
                });
                const description = block.description || "";
                
                const html = `
                    <li class="work-item" 
                        data-title="${title}" 
                        data-date="${date}" 
                        data-description="${description}">
                        <a href="#">
                            <img class="thumb" src="${imageUrl}" />
                        </a>
                    </li>
                `;
                
                const $newItem = $(html);
                $container.append($newItem);
                applyChaosLogic($newItem);
            });
        }

        init();
    });
    </script>

</body>
</html>